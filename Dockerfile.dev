# Use Swift 6.0 runtime image (includes development tools)
FROM swift:6.0-jammy

# Install any additional dependencies (if needed)
RUN apt update && apt install -y \
    libssl3 ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy package files first for caching
COPY Package.* ./
RUN swift package resolve

# Copy source code
COPY Sources ./Sources

# Build once for faster startup
RUN swift build -c debug

# Expose port
EXPOSE 8080

# Run the pre-built binary
CMD [".build/debug/App"]